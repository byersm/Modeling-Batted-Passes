---
title: "Examining Batted Passes in the NFL"
author: "Lucca Ferraz, Maggie Byers, Yixin (Amelia) Yuan"
format: 
  revealjs: 
    theme: sky
    slide-number: true
    chalkboard: true
    embed-resources: true
editor: visual
---

# Intro {.smaller}

-   Exploring the factors that go into causing batted passes
    -   Batted pass: defender hits the ball down shortly after QB releases it
    -   Typically results in incomplete pass, no yards gained
-   Initial characters
    -   QB height
    -   Offensive formation
    -   Defense formation
    -   Pass type
    -   Overall related more to defense or offense

# Data {.smaller}

-   Data from nflreadr
    -   Play by play data 2016 through 2023
    -   Player info - QB height
    -   Did not have information on which passes were batted
-   For The Numbers (FTN)
    -   Included tipped and batted passes from 2019 - 2023 seasons
    -   Detailed formation information from 2022 and 2023 seasons

# Methods {.smaller}

-   Focused on explaining variance, not predicting batted passes
-   Multilevel Logistic Model
    -   Random effects - quarterback, defensive team
    -   Fixed effects - QB height, pass location, number of players in backfield, pass rushers

# Exploratory Data Analysis {.smaller}
```{r}
#| echo: false
#| eval: true
#| message: true
#| warning: false
#| fig-align: "center"

library(tidyverse)
library(readxl)
# install.packages("ggthemes")
library(ggthemes)

#creating dataset
player_data <- nflreadr::load_players()
all_plays2023 <- nflreadr::load_pbp()
batted_passes <- read_excel("2019-2023 Batted Passes.xlsx")
excel_batted <- batted_passes
excel_batted$is_batted <- 1
excel_simple <- excel_batted |> 
  mutate(across(c("HOME", "AWAY"), ~ str_replace(
    string = .x, pattern = "LAR", replacement = "LA"))) |> 
  select(week = WEEK, home_team = HOME, away_team = AWAY, play_id = `PLAY ID`, is_batted)

all_plays2023 <- left_join(all_plays2023, excel_simple)
all_plays2023$is_batted <- all_plays2023$is_batted |> 
  replace_na(0)
pass_plays2023 <- all_plays2023 |> 
  filter(play_type == "pass")


pass_by_qb <- left_join(pass_plays2023, player_data, by = join_by(passer_player_id == gsis_id)) 

#plotting
pass_by_qb <- pass_by_qb |> 
  group_by(passer_player_name) |>   
  mutate(total_passes = n(), 
            total_batted_passes = sum(is_batted), 
            qb_height = mean(height)) |> 
  filter(total_passes>100)
pass_by_qb |> 
  ggplot(aes(x = qb_height, color = factor(is_batted))) +
  geom_density() +
  theme_clean() +
  theme(legend.position = "bottom") + 
  labs(
    title = "Density Plot of Passes by QB Height", 
    x = "QB Height (inches)", 
    y = "Density", 
    color = "Batted"
  ) 
```
::: {.r-stack}
Initial data analysis showed no influence from QB height
:::

# Model Coefficient Plot {.smaller}
```{r}
#| echo: false
#| eval: true
#| message: true
#| warning: false


```
::: {.r-stack}
Most consistent model variables: 
- Number of Pass Rushers
- Middle Passes

QB Height has an impact in the 2023 model but not 2022
:::


# Results 2 {.smaller}
```{r}
#| echo: false
#| eval: true
#| message: true
#| warning: false
library(tidyverse)

1+1
```


# Results 3 {.smaller}
```{r}
#| echo: false
#| eval: true
#| message: true
#| warning: false
library(tidyverse)

1+1
```


# Discussion {.smaller}
-   Overall defensive characteristics determine more of the variance of batted passes
-   More Batted Passes?
    - More Pass Rushers
    - Middle Passes
-   Less Batted Passes?
    - Taller QBs
    - More Offensive Backfielders
